package carstuff;

import java.util.Scanner;

public class CarGarageDriver {

    public static void main(String[] args) {
        Scanner in = new Scanner(System.in);
        String repeatProgram;

        do {
            System.out.println("Welcome to the Car and Garage program");
            int parkingSize = getIntInRange(in,
                    "Enter the number of parking space you would like to have in the garage.\nThe number should be between 1 and 10 inclusive.",
                    1, 10);

            Garage garage = new Garage(parkingSize);

            String menuChoice;
            do {
                garage.displayCars();
                displayOptions();
                menuChoice = in.nextLine().trim().toUpperCase();

                switch (menuChoice) {
                    case "A":  // refuel
                        if (garage.isEmpty()) {
                            System.out.println("There are no cars currently in the garage.");
                            break;
                        }
                        int spaceA = getIntInRange(in, "Which car would you like to add fuel to?", 1, garage.getSize());
                        System.out.println("How much fuel would you like to add?\nPlease enter an amount greater than zero.");
                        double amt = getPositiveDouble(in);
                        double result = garage.addFuelToCar(spaceA, amt);
                        if (result < 0) {
                            System.out.printf("The tank is not full and can take %.2f more gallons of fuel.%n", -result);
                        } else if (result > 0) {
                            System.out.printf("The tank is full and you have %.2f gallons left in the can.%n", result);
                        } else {
                            System.out.println("The tank is now full.");
                        }
                        break;

                    case "B":  // get a car to drive
                        if (garage.isEmpty()) {
                            System.out.println("There are no cars currently in the garage.");
                            break;
                        }
                        int spaceB = getIntInRange(in, "Which car would you like to drive?", 1, garage.getSize());
                        Car currentCar = garage.getCar(spaceB);
                        if (currentCar == null) {
                            System.out.println("THere is no car in that space!");
                            break;
                        }
                        System.out.println("How far would you like to drive?");
                        double dist = getPositiveDouble(in);
                        System.out.println("How fast would you like to drive?");
                        double spd = getPositiveDouble(in);

                        currentCar.setUpTrip(spd, dist);
                        boolean returned = currentCar.drive();
                        if (returned) {
                            System.out.printf("You drove the %d, %s, %s %.2f miles and returned it to its parking space.%n",
                                    currentCar.getYear(), currentCar.getMake(), currentCar.getModel(), dist);
                            if (!garage.parkCar(currentCar)) {
                                System.out.println("Parking is full (this should not usually happen right after removing).");
                            }
                        } else {
                            System.out.printf("The %s ran out of fuel.%n", currentCar.getModel());
                            System.out.println("It is parked somewhere on the side of the road.");
                        }
                        break;

                    case "C":  // add a car
                        if (!garage.hasSpace()) {
                            System.out.println("THere are not free parking spaces to add a new car.");
                            break;
                        }
                        System.out.println("Would you like to input the data yourself or create a random car?");
                        System.out.println("Please enter \"c\" for create yourself or \"r\" for random car.");
                        String how = in.nextLine().trim().toLowerCase();
                        Car newCar;
                        if (how.equals("c")) {
                            int year = getIntInRange(in, "Input the year of the car?\nPlease enter a date between 1920 and 2021.", 1920, 2021);
                            System.out.println("Please enter the Make of the car.");
                            String make = in.nextLine().trim();
                            System.out.println("Please enter the Model of the car.");
                            String model = in.nextLine().trim();
                            System.out.println("Please enter the color of the car.");
                            String color = in.nextLine().trim();
                            double tank = getDoubleInRange(in, "Input the size of the car's fuel tank.\nPlease enter a value between 8.0 and 34.99.", 8.0, 34.99);
                            double optimal = getDoubleInRange(in, "Input the car's optimal driving speed for best mileage.\nPlease enter a value between 45.0 and 64.99.", 45.0, 64.99);
                            double mpg = getDoubleInRange(in, "Input the car's fuel economy.\nPlease enter a value between 15.0 and 54.99.", 15.0, 54.99);
                            newCar = new Car(make, model, color, year, tank, mpg, optimal);
                        } else {
                            newCar = new Car();
                        }
                        if (!garage.parkCar(newCar)) {
                            System.out.println("Parking is full");
                        }
                        break;

                    case "Q":
                        System.out.println("Thank you for using this garage!");
                        break;

                    default:
                        System.out.println("Invalid menu choice");
                }

            } while (!menuChoice.equals("Q"));

            System.out.println("Would you like to repeat this program? (y/n)");
            repeatProgram = in.nextLine().trim().toLowerCase();
            while (!repeatProgram.equals("y") && !repeatProgram.equals("n")) {
                System.out.println("Please enter \"y\" for yes or \"n\" for no.");
                repeatProgram = in.nextLine().trim().toLowerCase();
            }

        } while (repeatProgram.equals("y"));

        System.out.println("Good-bye!");
        in.close();
    }

    private static void displayOptions() {
        System.out.println("A) Refuel a car");
        System.out.println("B) Get a Car to drive");
        System.out.println("C) Add a Car");
        System.out.println("Q) Quit");
        System.out.println();
        System.out.println("Please select one of the above choices.");
    }

    private static int getIntInRange(Scanner in, String prompt, int min, int max) {
        int val;
        while (true) {
            System.out.println(prompt);
            while (!in.hasNextInt()) {
                System.out.println("Please enter an integer.");
                in.next();
            }
            val = in.nextInt();
            in.nextLine(); // clear
            if (val >= min && val <= max) break;
            System.out.printf("Enter a valid integer number between %d and %d%n", min, max);
        }
        return val;
    }

    private static double getPositiveDouble(Scanner in) {
        double v;
        while (true) {
            while (!in.hasNextDouble()) {
                System.out.println("Please enter a number.");
                in.next();
            }
            v = in.nextDouble();
            in.nextLine();
            if (v > 0) break;
            System.out.println("Please enter an amount greater than zero.");
        }
        return v;
    }

    private static double getDoubleInRange(Scanner in, String prompt, double min, double max) {
        double v;
        while (true) {
            System.out.println(prompt);
            while (!in.hasNextDouble()) {
                System.out.println("Please enter a number.");
                in.next();
            }
            v = in.nextDouble();
            in.nextLine();
            if (v >= min && v <= max) break;
            System.out.printf("Enter a value between %.2f and %.2f%n", min, max);
        }
        return v;
    }
}
